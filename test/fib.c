#include <stdint.h>
#include "sct_internal.h"
#include "test.h"
#include "fib.h"

UNIT_TEST test_init_table(void) {
        SCORE_INIT();
        ASSERT(!fib_init_table());
        EXIT_TEST(1);
}

struct fib_case {
        uint64_t number;
        uint64_t expected_fib;
};

UNIT_TEST test_fibonacci(void) {
        SCORE_INIT();
        struct fib_case fib_cases[] = {
                {0, 0U},
                {1, 1U},
                {2, 1U},
                {3, 2U},
                {4, 3U},
                {5, 5U},
                {6, 8U},
                {7, 13U},
                {8, 21U},
                {9, 34U},
                {10, 55U},
                {11, 89U},
                {12, 144U},
                {13, 233U},
                {14, 377U},
                {15, 610U},
                {16, 987U},
                {17, 1597U},
                {18, 2584U},
                {19, 4181U},
                {20, 6765U},
                {21, 10946U},
                {22, 17711U},
                {23, 28657U},
                {24, 46368U},
                {25, 75025U},
                {26, 121393U},
                {27, 196418U},
                {28, 317811U},
                {29, 514229U},
                {30, 832040U},
                {31, 1346269U},
                {32, 2178309U},
                {33, 3524578U},
                {34, 5702887U},
                {35, 9227465U},
                {36, 14930352U},
                {37, 24157817U},
                {38, 39088169U},
                {39, 63245986U},
                {40, 102334155U},
                {41, 165580141U},
                {42, 267914296U},
                {43, 433494437U},
                {44, 701408733U},
                {45, 1134903170U},
                {46, 1836311903U},
                {47, 2971215073U},
                {48, 4807526976U},
                {49, 7778742049U},
                {50, 12586269025U},
                {51, 20365011074U},
                {52, 32951280099U},
                {53, 53316291173U},
                {54, 86267571272U},
                {55, 139583862445U},
                {56, 225851433717U},
                {57, 365435296162U},
                {58, 591286729879U},
                {59, 956722026041U},
                {60, 1548008755920U},
                {61, 2504730781961U},
                {62, 4052739537881U},
                {63, 6557470319842U},
                {64, 10610209857723U},
                {65, 17167680177565U},
                {66, 27777890035288U},
                {67, 44945570212853U},
                {68, 72723460248141U},
                {69, 117669030460994U},
                {70, 190392490709135U},
                {71, 308061521170129U},
                {72, 498454011879264U},
                {73, 806515533049393U},
                {74, 1304969544928657U},
                {75, 2111485077978050U},
                {76, 3416454622906707U},
                {77, 5527939700884757U},
                {78, 8944394323791464U},
                {79, 14472334024676221U},
                {80, 23416728348467685U},
                {81, 37889062373143906U},
                {82, 61305790721611591U},
                {83, 99194853094755497U},
                {84, 160500643816367088U},
                {85, 259695496911122585U},
                {86, 420196140727489673U},
                {87, 679891637638612258U},
                {88, 1100087778366101931U},
                {89, 1779979416004714189U},
                {90, 2880067194370816120U},
                {91, 4660046610375530309U},
                {92, 7540113804746346429U},
                {93, 12200160415121876738U},
        };

        for (size_t case_i = 0; case_i < ARRAY_LENGTH(fib_cases); case_i++) {
                struct fib_case case_ = fib_cases[case_i];
                ASSERT(case_.expected_fib == fibonacci(case_.number));
        }

        EXIT_TEST(ARRAY_LENGTH(fib_cases));
}

MODULE_TEST fib_test_main(void) {
        SCORE_INIT();
        UNIT_REPORT("fib_init_table()", test_init_table());
        UNIT_REPORT("fibonacci()", test_fibonacci());
        fib_free_table();
        RETURN_SCORE();
}
